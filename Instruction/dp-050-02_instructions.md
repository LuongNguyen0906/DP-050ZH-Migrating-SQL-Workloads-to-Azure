---
lab:
    title: '实验室 2 - 选择适用于数据迁移的正确工具'
    module: '模块 2：选择适用于数据迁移的正确工具'
---

# DP-050 - 将 SQL 工作负荷迁移到 Azure
# 实验室 2 - 选择适用于数据迁移的正确工具

**预计用时**：45 分钟

**先决条件**：没有用于执行此实验室的先决条件步骤。

**实验室文件**：这个实验室没有实验室文件

## 实验室概述

学生将在规定的 Data Platform Modernization 阶段使用两个工具以自动方式执行环境发现。他们还将识别任何迁移前兼容性问题，并在执行本地服务器迁移之前制定有关如何解决问题的计划。最后，他们将评估工作负荷在 Azure SQL 数据库的目标版本上的执行情况。

## 实验室目标
  
完成本实验室后，你将能够：

1. 使用 MAP 工具包构建数据库存清单 
2. 使用数据迁移助手确认迁移候选项

## 方案
  
你是 AdventureWorks 的高级数据工程师，正在为数据现代化项目做准备。首先，你将使用工具执行环境中存在的 SQL Server 清单。然后，你将对服务器进行评估，以确定在进行任何现代化工作之前需要解决的任何问题。其中一个本地 SQL Server 用于处理业务的销售，并且你希望确保可以将你的工作负荷处理为迁移到的目标服务。

## 练习 1：使用 MAP 工具包构建数据库存清单

在本实验中，你将使用 Microsoft 评估和计划工具包收集有关使用 SQL Server 2008 R2 在本地服务器上运行的 SQL Server 实例的信息。

预计用时：25 分钟

本次练习的主要任务如下：

1. 安装 Microsoft 评估和计划工具包
1. 创建 MAPS 清单数据库
1. 启用远程管理
1. 收集清单数据
1. 在 MAPS 中查看 Microsoft SQL Server 发现信息
1. 创建 SQL Server 报告

### 任务 1：安装 Microsoft 评估和计划工具包

1. 打开你的 Web 浏览器并转到 [Microsoft 评估和计划工具包下载站点](https://www.microsoft.com/zh-cn/download/details.aspx?id=7826)
1. 单击“**下载**”并将文件保存到本地文件夹。
1. 下载完成后，浏览到该文件夹并双击 **MapSetup.exe**。
1. 在“欢迎使用 Microsoft 评估和计划工具包安装向导”中，单击“**下一步**”。
1. 在“许可协议”屏幕中，单击“**我接受许可协议中的条款**”旁边的复选框，然后单击“**下一步**”。
1. 在安装“文件夹”屏幕中，单击“**下一步**”。
1. 在“开始安装”屏幕中，单击“**安装**”。
1. 在“已完成 Microsoft 评估和计划工具包安装向导”中，单击“**完成**”。

### 任务 2：创建 MAPS 清单数据库

1. 在 Windows 桌面上，单击“**开始**”，并键入 Microsoft Assessment，然后单击“**Microsoft 评估和计划工具包**”
1. 单击“**是**”接受用户帐户控制 (UAC) 对话框以运行此应用程序。
1. 在“创建或选择数据库”对话框中，单击“**创建库存数据库**”并输入“**MapsInventory**”作为新的数据库名称并单击“**确定**”。

### 任务 3：启用远程管理

1. 导航到“**命令提示符**”方法是转到“**开始**”→键入“**CMD**”，右键单击“**命令提示符**”，然后选择“**以管理员身份运行**”。
1. 输入以下命令并按 **Enter** 键：
**netsh advfirewall set currentprofile settings remotemanagement enable**

### 任务 4：收集清单数据

1. 如果尚未打开，请启动 MAP 工具包。你可能希望将应用程序调整为全屏。
1. 单击“**是**”接受用户帐户控制 (UAC) 对话框以运行此应用程序。
1. 在“**开始位置**”部分下方，单击“**执行清单**”启动清单向导。
1. 在里面“**清单方案**”页面，确保选中“**SQL Server**”的复选框，然后单击“**下一步**”。
1. 在“发现方法”页面，取消勾选“**使用 Active Directory 域服务 (AD DS)**”。
1. 勾选“**手动输入计算机名称和凭据**”，然后单击“**下一步**”。
1. 在“所有计算机凭据”页面中，单击“**创建**”。
1. 在“帐户输入”对话框中，在“帐户名”字段中键入本地计算机用户的“**用户名**”（例如：Administrator）
1. 在“**密码**”和“**确认密码**”字段，键入本地计算机用户的密码（例如：password），然后单击“**保存**”。
1. 在“所有计算机凭据”页面，单击“**下一步**”。
1. 在“凭据顺序”页面中单击“**下一步**”。 
1. 在“手动输入计算机”页面中，单击“**创建**”。
1. 在“指定计算机和凭据”页面中，键入本地计算机的名称（例如：MAP-HOL）作为计算机名并单击“**添加**”。
1. 勾选“**使用所有计算机凭据列表**”并单击“**保存**”。
1. 单击“**下一步**”并查看“摘要”页面中显示的信息。
1. 单击“**完成**”启动状态对话框和清单处理。
注意：如果在虚拟机上使用 MAP，即使你已指定仅清点一台计算机，MAP 工具包也会检测到它是虚拟机并尝试清点 VM 主机。在这种情况下，指定的凭据可能不允许执行此类清单。
1. 完成后，单击状态对话框中的“**关闭**”。

### 任务 5：在 MAPS 中查看 Microsoft SQL Server 发现信息

1.  在 **MAPS** 中，从主菜单中选择“**文件**”→“**创建/选择数据库...**”以启动“**创建或选择要使用的数据库**”对话框。
1.  单击“**使用现有数据库**”，从数据库菜单中选择“**MapsInventory**”，单击“**确定**”。
1.  在 UI 的左窗格中单击“**数据库方案**”组，然后单击“**SQL Server 发现**”磁贴。
1.  检查方案详细信息页面并观察带有 SQL Server 信息的饼形图。  

### 任务 6：创建 SQL Server 报告

1. 在“SQL Server 发现”屏幕的“选项”部分下，单击方案详细信息页面顶部的“**生成 SQL Server 数据库详细信息报告**”开始生成报告并启动状态对话框。
1. 状态对话框报告生成完成后，确保选中“关闭后打开报告文件夹”，然后单击“**关闭**”。
1. 打开 **SQLServerDatabaseDetails-<date-and-time>** Excel 文件。
1. 在 SQLServerAssessment Excel 报告中，查看“**SQLServerSummary**”选项卡以查看在网络中共找到多少个 SQL Server 数据库组件。关闭电子表格
1. 在“SQL Server 发现”屏幕的“选项”部分下，单击方案详细信息页面顶部的“**生成 SQL Server 评估报告**”开始生成报告并启动状态对话框。
1. 状态对话框报告生成完成后，确保选中“关闭后打开报告文件夹”，然后单击“**关闭**”。
1. 打开 **SQLServerDatabaseAssessment-<date-and-time>** Excel 文件
1. 查看“数据库实例”选项卡以查看列出的所有数据库实例以及服务器详细信息，包括服务器是否已虚拟化（计算机类型）。
1. 查看“组件”选项卡以查看列出的所有已安装的数据库组件以及服务器详细信息。
1. 查看后，关闭报告和文件浏览器。

> **结果**：完成本练习后，你已运行用于收集有关 SQL Server 实例的信息的 Microsoft 评估和计划工具包

## 练习 2：使用数据迁移助手确认迁移候选项
  
在本练习中，你将使用数据迁移助手查找 SQL Server 和 Azure SQL 数据库之间的 SQL Server 功能奇偶一致性和兼容性问题

预计用时：20 分钟
  
本次练习的主要任务如下：

1. 如何在 Windows 上安装数据迁移助手 (DMA)
1. 使用数据迁移助手。

### 任务 1：在 Windows 上安装数据迁移助手 (DMA)

> **注意**：如果已安装数据迁移助手，则可以跳过此任务。

1. 转到 [https://www.microsoft.com/zh-cn/download/details.aspx?id=53595](https://www.microsoft.com/zh-cn/download/details.aspx?id=53595)
1. 通过检查所需的系统要求，确认你的环境是否支持该软件。
1. 下载 **DataMigrationAssistant.msi** 然后单击“**安装**”：

    1. 双击安装程序“**DataMigrationAssistant.msi**”
    2. 单击“欢迎”屏幕上的“**下一步**”。
    3. 阅读用户许可协议并接受（如果适用），然后单击“**下一步**”。
    4. 阅读隐私声明，然后单击“**安装**”。
    5. 如果收到提示，则允许对此应用程序进行 UAC 控制。单击“**完成**”完成安装。

### 任务 2：使用数据迁移助手。

1. 打开应用程序“Microsoft 数据迁移助手”

    1. 选择“**+**”，这将打开新项目的对话框，键入以下信息：

        1. 项目类型：**评估**
        2. 项目名：**迁移评估 SQL DB**
        3. 源服务器类型：**SQL Server**
        4. 目标服务器类型：**Azure SQL 数据库**
        5. 单击“**创建**”
        6. 单击“**下一步**”
        7. 在“**连接到服务器**”对话框，在“**服务器名**”中输入“**localhost**”
        8. 单击“**连接**”
        9. 单击要评估的所有数据库，“**添加**”
        10. 单击“**开始评估**”

1. 查看找到的 SQL Server 功能奇偶一致性和兼容性问题。请注意功能奇偶一致性问题的数量。

1. 关闭数据迁移助手。使用 Azure SQL 数据库托管实例重播 Microsoft 数据迁移助手。

    1. 选择“**+**”，这将打开新项目的对话框，键入以下信息：
        
        1. 项目类型：**评估**
        2. 项目名：**迁移评估 SQL DB MI**
        3. 源服务器类型：**SQL Server**
        4. 目标服务器类型：**Azure SQL 数据库托管实例**
        5. 单击“**创建**”
        6. 单击“**下一步**”
        7. 在“**连接到服务器**”对话框，在“**服务器名**”中输入“**localhost**”
        8. 单击“**连接**”
        9. 单击要评估的所有数据库，“**添加**”
        10. 单击“**开始评估**”

1. 查看找到的 SQL Server 功能奇偶一致性和兼容性问题。请注意功能奇偶一致性问题的数量。

1. 关闭数据迁移助手。使用 Azure 虚拟机上的 SQL Server 重播 Microsoft 数据迁移助手。

    1. 选择“**+**”，这将打开新项目的对话框，键入以下信息：
    
        1. 项目类型：**评估**
        2. 项目名：**迁移评估 Azure VM**
        3. 源服务器类型：**SQL Server**
        4. 目标服务器类型：**Azure SQL 数据库托管实例**
        5. 单击“**创建**”
        6. 单击“**下一步**”
        7. 在“**服务器名**”中输入： **localhost**
        8. 单击“**连接**”
        9. 单击要评估的所有数据库，“**添加**”
        10. 单击“**开始评估**”

1. 查看找到的 SQL Server 功能奇偶一致性和兼容性问题。请注意功能奇偶一致性问题的数量。

> **结果**：完成此练习后，你已收集有关在 SQL Server 实例与 Azure SQL 数据库之间发现的 SQL Server 功能奇偶一致性和兼容性问题的信息。

## 实验室评价

大约 45 分钟后，讲师将结束此实验室。班级将讨论每个组的检测结果。

